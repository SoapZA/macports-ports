# -*- coding: utf-8; mode: tcl; tab-width: 4; indent-tabs-mode: nil; c-basic-offset: 4 -*- vim:fenc=utf-8:ft=tcl:et:sw=4:ts=4:sts=4

PortSystem          1.0

name                libsndfile
version             1.0.31
revision            1
categories          audio
maintainers         nomaintainer
platforms           darwin

description         read and write files containing sampled sound
long_description    libsndfile is a C library for reading and writing files \
                    containing sampled sound through one standard library interface. \
                    libsndfile has the following main features: \
                    ability to read and write a large number of file formats, \
                    a simple, elegant and easy to use API, \
                    and on the fly format conversion.
license             LGPL-2.1+
homepage            https://libsndfile.github.io/libsndfile/
master_sites        https://github.com/libsndfile/libsndfile/releases/download/${version}/

distname            libsndfile-${version}
use_bzip2           yes

checksums           rmd160  ae3fc5bbcb10a034f3edc1240acacd9f1ec349a7 \
                    sha256  a8cfb1c09ea6e90eff4ca87322d4168cdbe5035cb48717b40bf77e751cc02163 \
                    size    875335

test.run            yes

depends_build       port:pkgconfig
depends_lib         port:flac port:libogg port:libopus port:libvorbis

post-patch {
    # Clang doesn't understand this flag
    reinplace "s/ -Wno-format-truncation//g" configure
}

configure.args \
    --disable-static \
    --enable-shared \
    --disable-alsa \
    --disable-octave \
    --disable-silent-rules \
    --disable-sqlite \
    --disable-test-coverage \
    --disable-experimental \
    --enable-external-libs

variant no_external_libs description {Disable FLAC, Ogg, Opus and Vorbis support} {
    depends_lib-delete    port:flac port:libogg port:libopus port:libvorbis
    configure.args-append --disable-external-libs
    configure.args-delete --enable-external-libs
}

variant experimental description {Enable experimental support for Speex} {
    depends_lib-append    port:speex
    configure.args-append --enable-experimental
    configure.args-delete --disable-experimental
}
